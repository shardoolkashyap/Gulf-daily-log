<!DOCTYPE html>
<html>
  <head>
    <style>
      /* General styling */
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        background-color: #f2f2f2;
      }

      form {
        width: 100%;
        background: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        box-sizing: border-box;
      }

      .title-container {
        display: flex;
      }

      h3 {
        font-size: 40px;
        color: #4caf50;
      }

      label {
        display: block;
        margin-top: 40px;
        font-weight: bold;
        font-size: 16px;
      }

      input[type="text"],
      input[type="number"],
      input[type="date"],
      input[type="time"],
      select {
        width: 100%;
        padding: 12px;
        margin-top: 5px;
        border: 1px solid #ddd;
        border-radius: 4px;
        box-sizing: border-box;
        font-size: 14px;
      }

      button {
        width: 100%;
        padding: 12px;
        background-color: #4caf50;
        color: white;
        border: none;
        border-radius: 4px;
        font-size: 16px;
        cursor: pointer;
        margin-top: 20px;
      }

      button:hover {
        background-color: #45a049;
      }

      /* Responsive adjustments for smaller screens */
      @media (max-width: 600px) {
        body {
          padding: 10px;
        }

        form {
          padding: 15px;
        }

        label {
          font-size: 14px;
        }

        input[type="text"],
        input[type="number"],
        input[type="date"],
        input[type="time"],
        select {
          padding: 10px;
          font-size: 12px;
        }

        button {
          font-size: 14px;
          padding: 10px;
        }
      }

      /* Extra responsiveness for very small screens (e.g., phones under 400px width) */
      @media (max-width: 400px) {
        label {
          font-size: 12px;
        }

        input[type="text"],
        input[type="number"],
        input[type="date"],
        input[type="time"],
        select {
          padding: 8px;
          font-size: 12px;
        }

        button {
          font-size: 12px;
          padding: 8px;
        }
      }
    </style>
  </head>
  <body>
    <div class="title-container">
      <h3>Daily Log Entry Form</h3>
    </div>
    <form id="logForm">
      <label>Serial No:</label>
      <input type="text" name="serialNo" readonly />

      <label>Opening Date:</label>
      <input
        type="date"
        name="openingDate"
        required
        onchange="populateWeekAndMonth()"
      />

      <label>Week:</label>
      <input type="text" name="week" readonly />

      <label>Month:</label>
      <input type="text" name="month" readonly />

      <label>Depot Name:</label>
      <select name="depotName" id="depotNameDropdown" required>
        <option value="">Select a Depot</option>
        <!-- Add Depot Options Here -->
      </select>

      <label>Vehicle No:</label>
      <select name="vehicleNo" id="vehicleDropdown" required>
        <option value="">Select a Vehicle</option>
        <!-- Add Vehicle Options Here -->
      </select>

      <label>Vehicle Reporting Time:</label>
      <input type="time" name="reportingTime" required />

      <label>ADBLUE / DEF Filled:</label>
      <select
        name="adblueDef"
        onchange="toggleQuantityField(this, 'defLitresFilledQty')"
      >
        <option value="No" selected>No</option>
        <option value="Yes">Yes</option>
      </select>

      <label>DEF Litres Filled Qty (L):</label>
      <input
        type="number"
        name="defLitresFilledQty"
        id="defLitresFilledQty"
        disabled
      />

      <label>ENGINE OIL Filled:</label>
      <select
        name="engineOil"
        onchange="toggleQuantityField(this, 'engineOilQty')"
      >
        <option value="No" selected>No</option>
        <option value="Yes">Yes</option>
      </select>

      <label>ENGINE OIL Filled Qty (L):</label>
      <input type="number" name="engineOilQty" id="engineOilQty" disabled />

      <label>COOLANT Filled:</label>
      <select name="coolant" onchange="toggleQuantityField(this, 'coolantQty')">
        <option value="No" selected>No</option>
        <option value="Yes">Yes</option>
      </select>

      <label>COOLANT Filled Qty (L):</label>
      <input type="number" name="coolantQty" id="coolantQty" disabled />

      <label>Closing Date:</label>
      <input type="date" name="closingDate" required />

      <label>Closing KM Reading:</label>
      <input type="number" name="closingKMReading" readonly />

      <label>No of KMs Ran:</label>
      <input type="number" name="kmsRan" readonly />

      <label>Photograph of Refill Qty (Y/N):</label>
      <select name="refillPhoto">
        <option value="Yes">Yes</option>
        <option value="No">No</option>
      </select>

      <label>Driver / Depot Staff Name:</label>
      <input type="text" name="driverName" required />

      <label>Driver / Depot Staff Signature (Y/N):</label>
      <select name="driverSignature">
        <option value="Yes">Yes</option>
        <option value="No">No</option>
      </select>

      <label>Gulf Operator / Staff Signature (Y/N):</label>
      <select name="gulfSignature">
        <option value="Yes">Yes</option>
        <option value="No">No</option>
      </select>

      <button type="button" onsubmit="confirmSubmit()">Submit</button>
    </form>

    <script>
      // Function to fetch the next Serial Number
      function fetchSerialNo() {
        google.script.run
          .withSuccessHandler(function (serialNo) {
            document.getElementsByName("serialNo")[0].value = serialNo;
          })
          .getNextSerialNo();
      }

      // Populate Week and Month based on Date
      function populateWeekAndMonth() {
        const dateField = document.getElementsByName("openingDate")[0].value;
        const date = new Date(dateField);
        const weekField = document.getElementsByName("week")[0];
        const monthField = document.getElementsByName("month")[0];

        if (date) {
          const weekNumber = Math.ceil(date.getDate() / 7); // Simple week calculation
          const monthName = date.toLocaleString("default", { month: "long" });

          weekField.value = `Week ${weekNumber}`;
          monthField.value = monthName;
        }
      }

      // Toggle quantity field based on the "Yes" or "No" selection for material type
      function toggleQuantityField(selectElement, quantityFieldId) {
        const quantityField = document.getElementById(quantityFieldId);
        if (selectElement.value === "Yes") {
          quantityField.disabled = false; // Enable the field if "Yes" is selected
        } else {
          quantityField.disabled = true; // Disable and clear the field if "No" is selected
          quantityField.value = ""; // Clear the field when disabled
        }
      }

      // Confirmation before submission
      function confirmSubmit() {
        if (confirm("Are you sure you want to submit?")) {
          submitForm();
        }
      }

      // Submit form data to Apps Script
      function submitForm() {
        const form = document.getElementById("logForm");
        const formData = new FormData(form);
        google.script.run
          .withSuccessHandler(() => {
            alert("Data submitted successfully!");
            form.reset(); // Reset form after submission
            fetchSerialNo(); // Fetch next Serial No after submission
          })
          .addEntry(Object.fromEntries(formData));
      }

      // Fetch initial Serial Number when page loads
      window.onload = fetchSerialNo;
    </script>
  </body>
</html>
